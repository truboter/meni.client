# Privacy Policy Translation Script

Автоматический перевод политики конфиденциальности с использованием OpenAI GPT-4 и кешированием в S3.

## Возможности

- ✅ **Умный перевод**: Использует GPT-5.1 для профессионального перевода юридических документов
- ✅ **Кеширование в S3**: Сохраняет переводы абзацев в `cdn.meni/legal/translations/`
- ✅ **Сохранение форматирования**: Полностью сохраняет markdown разметку
- ✅ **Юридическая точность**: Специализированный промпт для GDPR документов
- ✅ **Экономия**: Повторные переводы берутся из кеша
- ✅ **27 языков**: Поддержка всех языков платформы

## Требования

1. OpenAI API ключ в `.env.local`:

   ```env
   VITE_OPENAI_API_KEY=sk-your-key-here
   ```

2. AWS credentials настроены для доступа к S3 bucket `cdn.meni`

## Использование

### Базовое использование

```bash
npm run translate-privacy -- --target ru
```

### Параметры

- `--target <lang>` - Код языка перевода (ru, ka, de, fr, и т.д.)
- `--no-cache` - Игнорировать кеш и переделать перевод заново

**Примечание:** Исходный файл всегда `public/legal/privacy-en.md`, результат сохраняется в `public/legal/privacy-{lang}.md`

### Примеры

**Перевод на русский:**

```bash
npm run translate-privacy -- --target ru
```

**Перевод на грузинский:**

```bash
npm run translate-privacy -- --target ka
```

**Перевод на немецкий без кеша:**

```bash
npm run translate-privacy -- --target de --no-cache
```

## Поддерживаемые языки

| Код | Язык        | Код | Язык       |
| --- | ----------- | --- | ---------- |
| ru  | Russian     | de  | German     |
| ka  | Georgian    | fr  | French     |
| it  | Italian     | tr  | Turkish    |
| he  | Hebrew      | es  | Spanish    |
| ar  | Arabic      | zh  | Chinese    |
| hi  | Hindi       | bn  | Bengali    |
| pt  | Portuguese  | id  | Indonesian |
| ur  | Urdu        | ja  | Japanese   |
| ko  | Korean      | vi  | Vietnamese |
| pl  | Polish      | uk  | Ukrainian  |
| fa  | Persian     | hy  | Armenian   |
| az  | Azerbaijani | kk  | Kazakh     |
| uz  | Uzbek       | ab  | Abkhazian  |

## Как работает

1. **Разбивка документа**: Исходный файл разбивается на логические блоки (абзацы, секции)

2. **Проверка кеша**: Для каждого блока генерируется хеш, проверяется наличие в S3

3. **Перевод**: Если кеша нет - отправляется запрос в GPT-4o с специализированным промптом

4. **Сохранение**: Переведенный блок сохраняется в S3 с ключом:

   ```
   legal/translations/{lang}/{hash}.md
   ```

5. **Сборка**: Все блоки объединяются в финальный документ

## Кеш в S3

Структура кеша в `cdn.meni`:

```
legal/
  translations/
    ru/
      a1b2c3d4e5f6g7h8.md  (хеш абзаца 1)
      9i8j7k6l5m4n3o2p.md  (хеш абзаца 2)
      ...
    ka/
      ...
    de/
      ...
```

### Преимущества кеширования

- Экономия API токенов (избегание повторных переводов)
- Быстрая обработка при частичных обновлениях
- Консистентность терминологии между запусками

## Особенности промпта

Промпт настроен специально для юридических документов:

1. **Юридическая точность**: Правильные термины GDPR
2. **Консистентность**: Единообразие терминологии
3. **Сохранение структуры**: Markdown форматирование
4. **Технические термины**: Правильная обработка IT терминов
5. **Низкая температура** (0.3): Для стабильности переводов

## Стоимость

Примерная стоимость перевода одного privacy policy (~ 8000 слов):

- **GPT-4o**: ~$0.20-0.40 за документ
- **С кешом**: Только новые/измененные абзацы

## Troubleshooting

### Ошибка "API key not found"

```bash
# Проверьте .env.local:
cat .env.local

# Должно быть:
VITE_OPENAI_API_KEY=sk-...
```

### Ошибка доступа к S3

```bash
# Проверьте AWS credentials:
aws sts get-caller-identity

# Проверьте доступ к бакету:
aws s3 ls s3://cdn.meni/legal/
```

### Медленный перевод

- Нормально: ~1-2 секунды на абзац
- С кешом: мгновенно
- Используйте `--no-cache` только при необходимости

## Обновление переводов

При изменении английской версии:

1. Измененные абзацы получат новый хеш
2. Новые хеши не найдутся в кеше
3. Только они будут переведены заново
4. Остальные возьмутся из кеша

## Планы развития

- [ ] Batch processing для нескольких языков
- [ ] Diff viewer для сравнения версий
- [ ] Webhook для автоматического перевода при git push
- [ ] Web UI для управления переводами
- [ ] Терминологический глоссарий для консистентности

## License

MIT
